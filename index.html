<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ‰¾è³‡æ–™å¤¾éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      background-color: #111;
      color: white;
      font-family: sans-serif;
    }
    canvas {
      border: 2px solid white;
      margin-top: 10px;
    }
    #message {
      margin-top: 10px;
      font-size: 22px;
    }
    button {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background: #ffcc00;
    }
  </style>
</head>
<body>
  <h1>ğŸ” æ‰¾åˆ°çœŸæ­£çš„è³‡æ–™å¤¾ï¼</h1>
  <canvas id="gameCanvas" width="800" height="500"></canvas>
  <div id="message">é»æ“Šé–‹å§‹éŠæˆ²</div>
  <div id="timer"></div>
  <button id="restartBtn" style="display:none;">é‡æ–°æŒ‘æˆ°</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const message = document.getElementById("message");
    const timerDisplay = document.getElementById("timer");
    const restartBtn = document.getElementById("restartBtn");

    let currentLevel = 0;
    let timeLeft = 0;
    let timer = null;
    let refreshInterval = null;
    let folders = [];
    let gameOver = false;

    function drawBackground(level) {
      const colors = ["#333366","#336633","#663333"];
      ctx.fillStyle = colors[level];
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    function drawFolder(x,y,isReal) {
      ctx.fillStyle = "#ffcc00";
      ctx.fillRect(x,y,50,40);
      ctx.fillStyle = "#cc9900";
      ctx.fillRect(x,y-10,20,15);
      folders.push({x,y,w:60,h:50,isReal,isFake:true,transformed:false});
    }

    function drawFileIcon(x,y,type) {
      ctx.fillStyle = "white";
      ctx.fillRect(x,y,40,40);
      ctx.fillStyle = "black";
      ctx.font = "16px sans-serif";
      ctx.fillText(type,x+5,y+25);
    }

    function drawWin() {
      ctx.fillStyle = "#222";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "lime";
      ctx.font = "40px sans-serif";
      ctx.fillText("ğŸ‰ é€šé—œæˆåŠŸï¼",250,250);
    }

    function drawLose() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "red";
      ctx.font = "40px sans-serif";
      ctx.fillText("âŒ æŒ‘æˆ°å¤±æ•—ï¼",250,250);
    }

    function startTimer(limit) {
      timeLeft = limit;
      timerDisplay.textContent = "å‰©é¤˜æ™‚é–“: " + timeLeft + " ç§’";
      timer = setInterval(()=>{
        timeLeft--;
        timerDisplay.textContent = "å‰©é¤˜æ™‚é–“: " + timeLeft + " ç§’";
        if (timeLeft <= 0) {
          endGame(false);
        }
      },1000);
    }

    function clearIntervals() {
      clearInterval(timer);
      clearInterval(refreshInterval);
    }

    function startLevel(level) {
      clearIntervals();
      gameOver = false;
      folders = [];
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBackground(level);
      message.textContent = "ç¬¬ " + (level+1) + " é—œ";

      let folderCount;
      let limit;
      if (level===0) { folderCount=3; limit=10; }
      if (level===1) { folderCount=8; limit=15; }
      if (level===2) { folderCount=12; limit=30; }

      const realIndex = Math.floor(Math.random()*folderCount);
      for (let i=0;i<folderCount;i++) {
        const x = Math.random()*(canvas.width-60);
        const y = Math.random()*(canvas.height-60);
        drawFolder(x,y,i===realIndex);
      }

      if (level===2) {
        refreshInterval = setInterval(()=>{
          if (gameOver) return;
          ctx.clearRect(0,0,canvas.width,canvas.height);
          drawBackground(level);
          folders=[];
          const newReal = Math.floor(Math.random()*folderCount);
          for (let i=0;i<folderCount;i++) {
            const x = Math.random()*(canvas.width-60);
            const y = Math.random()*(canvas.height-60);
            drawFolder(x,y,i===newReal);
          }
        },3000);
      }

      startTimer(limit);
    }

    function endGame(win) {
      if (gameOver) return;
      gameOver = true;
      clearIntervals();
      if (win) {
        drawWin();
        message.textContent = "ğŸ‰ ä½ è´äº†ï¼";
      } else {
        drawLose();
        message.textContent = "âŒ æ™‚é–“åˆ°ï¼";
        restartBtn.style.display="inline-block";
      }
      canvas.onclick=null;
    }

    canvas.addEventListener("click",(e)=>{
      if (gameOver) return;
      const rect=canvas.getBoundingClientRect();
      const clickX=e.clientX-rect.left;
      const clickY=e.clientY-rect.top;

      for (let f of folders) {
        if (clickX>=f.x && clickX<=f.x+f.w && clickY>=f.y && clickY<=f.y+f.h) {
          if (f.isReal) {
            currentLevel++;
            if (currentLevel<3) {
              startLevel(currentLevel);
            } else {
              endGame(true);
            }
            return;
          } else {
            if (!f.transformed) {
              f.transformed=true;
              const typeArr=["IMG","MP3","MP4"];
              const t=typeArr[Math.floor(Math.random()*typeArr.length)];
              ctx.clearRect(f.x,f.y,f.w,f.h);
              drawFileIcon(f.x,f.y,t);
              setTimeout(()=>{
                if (!gameOver) {
                  ctx.clearRect(f.x,f.y,f.w,f.h);
                  drawFolder(f.x,f.y,false);
                }
              },3000);
              message.textContent="âŒ å‡çš„è³‡æ–™å¤¾ï¼";
            }
          }
        }
      }
    });

    restartBtn.addEventListener("click",()=>{
      restartBtn.style.display="none";
      currentLevel=0;
      startLevel(currentLevel);
    });

    // åˆå§‹åŒ–
    message.textContent="é»æ“Šç•«å¸ƒé–‹å§‹éŠæˆ²";
    canvas.onclick=()=>{
      currentLevel=0;
      startLevel(currentLevel);
    }
  </script>
</body>
</html>
